<nav id="sidebar" class="sidebar-wrapper">
    <div class="sidebar-brand">
        <a href='{{ with .Site.Params.docs.logoLinkURL }}{{ . }}{{ else }}{{ relLangURL "" }}{{ end }}' aria-label="HomePage" alt="HomePage">
            {{ with resources.Get "images/logos/logo.svg" }}
                {{ .Content | safeHTML }}
            {{ end }}
        </a>
    </div>
    <div class="sidebar-content" style="height: calc(100% - 131px);">
        <ul class="sidebar-menu">
            {{ $currentPage := . -}}
            {{ $section := $currentPage.Section -}}
            
            {{/* Find the pages to show at the top level, matching original logic */}}
            {{ $pagesToShow := "" }}
            {{ range (where .Site.Sections.ByWeight "Section" "in" $section) }}
                {{ $pagesToShow = union .Sections .Pages }}
            {{ end }}

            {{/* This is the only call needed. 
              It passes the top-level pages and the current page context to the partial.
            */}}
            {{ partial "sidebar-menu.html" (dict "Pages" $pagesToShow "currentPage" $currentPage "isNested" false) }}

        </ul>
        </div>
    <ul class="sidebar-footer list-unstyled mb-0">
            </ul>
    </nav>